---
import Link from "@components/Link.astro";
import type { CompanyListItem } from "@lib/queries/companies";

interface Props {
  company: CompanyListItem;
  hasRecentActivity?: boolean;
}

const { company, hasRecentActivity = false } = Astro.props;

const maxTechDisplay = 4;
const visibleTechs = company.technologies.slice(0, maxTechDisplay);
const remainingCount = company.technologies.length - maxTechDisplay;
---

<li
  class="py-3 border-b border-zinc-800/60"
  data-company
  data-name={company.name.toLowerCase()}
  data-techs={company.technologies.join(" ").toLowerCase()}
  data-locations={company.locations.join(" ").toLowerCase()}
>
  <!-- Row 1: Name + badges + job count -->
  <div class="flex items-baseline justify-between gap-3">
    <div class="flex items-baseline gap-2 min-w-0">
      <Link href={`/nz-tech/companies/${company.slug}/`}>{company.name}</Link>
      {
        hasRecentActivity && (
          <span class="text-[11px] text-sky-400/80 shrink-0">new</span>
        )
      }
    </div>
    <span
      class="text-sm text-zinc-500 tabular-nums shrink-0"
      data-job-count={company.jobCount}
    >
      {company.jobCount}
      {company.jobCount === 1 ? "job" : "jobs"}
    </span>
  </div>
  <!-- Row 2: Location + tech summary (always present, consistent height) -->
  <div class="flex items-baseline gap-1.5 mt-1 text-sm text-zinc-500">
    {
      company.locations.length > 0 && (
        <span>{company.locations.join(", ")}</span>
      )
    }
    {
      company.locations.length > 0 && company.technologies.length > 0 && (
        <span class="text-zinc-700">&middot;</span>
      )
    }
    {
      company.technologies.length > 0 && (
        <span class="text-zinc-600 truncate">
          {visibleTechs.join(", ")}
          {remainingCount > 0 && (
            <span class="text-zinc-700"> +{remainingCount}</span>
          )}
        </span>
      )
    }
  </div>
</li>
